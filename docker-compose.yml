version: '3.8'

services:
  ollama:
    image: ollama/ollama
    container_name: ariel_brain
    volumes:
      - ./ollama_data:/root/.ollama
    ports:
      - "11434:11434"
    restart: always

  ariel_body:
    image: python:3.12-slim
    container_name: ariel_body
    depends_on:
      - ollama
    volumes:
      - .:/app
      - ./memory:/app/memory
      - ./backups:/app/backups
    working_dir: /app
    env_file: .env
    # 🌟 關鍵修正：由哨兵(launcher)啟動，實現自癒
    command: sh -c "pip install discord.py aiohttp python-dotenv && python ariel_launcher.py"
    restart: always